version: 2.1

workflows:
  build:
    jobs:
      - build

executors:
  default:
    docker:
      - image: gableroux/unity3d:2018.4.6f1-android
    environment:
      DISPLAY: ":0"

jobs:
  build:
    parallelism: 1
    executor: default
    steps:
      - build

commands:
  build:
    description: build
    steps:
      - run:
          name: build
          command: |
            echo $ANDROID_HOME
            echo $ANDROID_NDK_HOME
            ls -al /opt
            Xvfb -screen 0 640x480x24:32 &
            /opt/Unity/Editor/Unity -quit -batchmode -quit -serial $UNITY_SERIAL -username "$UNITY_USERNAME" -password "$UNITY_PASSWORD" -logFile || true
            /opt/Unity/Editor/Unity -quit -batchMode -buildTarget Android -executeMethod UnityCIExample.Builder.BuildPlayer || true
            ls -al
            /opt/Unity/Editor/Unity -quit -batchmode -quit -serial $UNITY_SERIAL -username "$UNITY_USERNAME" -password "$UNITY_PASSWORD" -logFile -returnlicense || true
